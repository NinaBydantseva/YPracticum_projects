## Проект:

Персонализация предложений товаров в интернет-магазине для увеличения покупательской активности

## Задача:

Разработать решение, которое позволит персонализировать предложения постоянным клиентам, чтобы увеличить их покупательскую активность.    
- Нужно построить модель, которая предскажет вероятность снижения покупательской активности клиента в следующие три месяца.    
- В исследование нужно включить дополнительные данные финансового департамента о прибыльности клиента: какой доход каждый покупатель приносил компании за последние три месяца.    
- Используя данные модели и данные о прибыльности клиентов, нужно выделить сегменты покупателей и разработать для них персонализированные предложения.    

## Решение:
- Использованные библиотеки Python:
  - pandas,
  - seaborn,
  - numpy,
  - shap,
  - phik,
  - matplotlib.pyplot,
  - sklearn,

### Ход решения:
   
Для решения этой задачи мы прошли все этапы работы с данными:    
- на этапе **предобработки данных** мы избавились от орфографических ошибок в данных, дублей данные не содержали;
- на этапе **исследовательского анализа** мы выяснили, что:     
 - в представленных данных есть количественные и категориальные данные;
 - количественные данные имеют близкое к нормальному распределение, но смещены влево;
 - из анализа самих данных вы составили приблизительный портрет клиента интернет-магазина:    
      - Покупательская *активность* большинства покупателей *сохраняется на прежнем уровне* (приблизительно 800 против 500);
      - Тип сервиса Стандарт *популярнее* Премиума (приблизительно 900 против 400);
      - Большая часть покупателей *согласились с рассылкой* предложений (приблизительно 1000 против 400);
      - Самая популярная категория у покупателей - Товары для детей (приблизительно 325 против 250 в следующей по популярности категории).   
 - данные дополнительных таблиц с выручкой по месяцам, прибылью и количеством проведенных на сайте минут также имеют нормальное распределение.
- перед началом **корреляционного анализа** данных мы собрали из всех переданных заказчиком файлов единый набор, его дальше и исследовали.
    Выяснили, что на наш *целевой показатель Покупательская активность* больше всего влияют:
    - Количество минут, проведенных на сайте за последние 3 месяца (Минут3мес),
    - Количество страниц, просмотренных покупателем за 1 визит (Страниц_за_визит),
    - Маркетинговая активность компании за последние 6 месяцев и Средний просмотр категорий за 1 визит покупателя в равной степени,
    - Акционные_покупки,
    - Неоплаченные_продукты_штук_квартал.
- на следующем этапе мы **собрали пайплайн** для построения модели машинного обучения. Описали в пайплайне 4 модели:
    - KNeighborsClassifier(),
    - DecisionTreeClassifier(),
    - LogisticRegression(),
    - SVC(),
    для которых подобрали гиперпараметры, из которых модель отобрала лучшую, которой оказалась модель логистической регрессии со следующими параметрами:    
    - LogisticRegression(C=3, penalty='l1', random_state=42, solver='liblinear'),
    - лучшей метрикой roc_auc, определенной кросс-валидацией = 0.9.    
    и показателями точности прогноза на тестовой выборке:    
    - roc_auc = 0.92,
    - f1-мера = 0.89.    
- для проверки адекватности полученной нами модели мы обучили еще одну модель методом DummyClassifier на тренировочных данных. Проверили ее качество на тестовой выборке и подсчитали оценку roc-auc, которой оценивали первую рабочую модель. Оценка roc_auc, которую мы рассчитали для модели Dummy, получилась равной 0.5. То есть все наши усилия оправдали себя.    
- следующим этапом мы проанализировали модель и оценили важность признаков, на которых она построила прогноз:
    - самыми значимыми оказались:
        - покупка акционных продуктов,
        - покупки в категории Мелкая бытовая техника и Техника для красоты и здоровья,
        - средний показатель просмотров категорий за визит,
        - количество минут, проведенных на сайте в последние 3 месяца,
        - неоплаченные продукты в корзине.
    - совершенно не влияющими на решение:
        - суммарная выручка за последние 3 месяца,
        - действия маркетологов в текущем месяце.
    Из анализа индивидуального влияния признаков на конечное решение спрогнозировать снижение покупательской активности пользователя, построенную с применением SHAP-методов, мы увидели, что:    
        - чем больше акционных товаров у покупателя, тем выше риск снижения его покупательской активности,
        - чем больше покупок в категориях мелкая бытовая техника и техника для красоты, тем выше шансы у такого покупателя сохранить покупательскую активность,
        - увеличение показателя среднего просмотра категорий за визит сохраняет его покупательскую способность, а уменьшение - снижает и покупательскую активность,
        - также увеличение количества страниц и минут за визит ведут к сохранению покупательской способности.    
    В итоге, мы предлагаем интернет-магазину:
        - признаки Акционные_покупки и мелкая бытовая техника и техника для красоты и здоровья в Популярная_категория сильно влияют на покупательскую способность клиента, так что необходимо их правильно сочетать;
        - для людей, которые и так часто покупают товары, необходимо снизить количество маркетинговых предложений, чтобы не "пережать";
        - для всех покупателей необходимо рекламировать товары из категорий, где они не делают покупок, например, контекстной рекламой; 
- последним этапом мы сегментировали клиентов для построения детального портрета клиента, который максимально близок к снижению покупательской способности в ближайшие 3 месяца. Для этого мы взяли за отправную точку самый важный показатель нашей модели - Акция, то есть люди, которые совершают большинство своих покупок по акции. Используя вероятности снижения покупательской способности для таких клиентов, предсказанные моделью, мы задали порог в 0.6 и отобрали 52 клиента. Для них мы проанализировали категории, в которых они предпочитают делать покупки, и тип сервиса. Получилось, что это люди, предпочитающие стандартный сервис и покупающие товары для детей, домашние текстиль, посуду и косметику.
    Мы сделали вывод, что мы получили портрет женщины и большинство из них - молодые мамы.    
    Какой совет можно дать бизнесу, чтобы привлечь внимание такой категории покупателей? Предложить им товары для мужчин по акции, бесплатную доставку с каждой n-ной покупкой.

## Вывод:

Мы предложили бизнесу комплексное решение, состоящее из:
- обученной модели машинного обучения (LogisticRegression(C=3, penalty='l1', random_state=42, solver='liblinear')),
- рекомендаций по персонализированным предложениям в соответствии с проведенной сегментацией покупателей.
